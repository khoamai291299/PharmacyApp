<UserControl x:Class="PharmacyApp.Views.Pages.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:scott="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">

            <!-- BIỂU ĐỒ DOANH THU -->
            <materialDesign:Card Padding="16" Margin="0 0 0 24" Background="#EFF6FF">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0 0 0 12">
                        <TextBlock Text="Biểu đồ doanh thu"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#1D4ED8"/>
                        <ComboBox Width="160"
                                  Margin="16 0 0 0"
                                  ItemsSource="{Binding PeriodOptions}"
                                  SelectedItem="{Binding SelectedPeriod}"/>
                    </StackPanel>

                    <scott:WpfPlot x:Name="RevenuePlot" Height="320"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- CHỌN KHOẢNG NGÀY -->
            <materialDesign:Card Padding="12" Margin="0 0 0 20" Background="#E3F2FD">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <DatePicker SelectedDate="{Binding FromDate}" Width="120"/>
                    <TextBlock Text="→" Margin="6" VerticalAlignment="Center"/>
                    <DatePicker SelectedDate="{Binding ToDate}" Width="120"/>

                    <Button Content="Áp dụng"
                Margin="12 0 0 0"
                Padding="14 6"
                Command="{Binding ApplyDateFilterCommand}"
                Background="#2563EB"
                Foreground="White"/>

                    <Button Content="Xuất báo cáo"
                Margin="8 0 0 0"
                Padding="14 6"
                Command="{Binding ExportPdfCommand}"
                Background="#1D4ED8"
                Foreground="White"
                Visibility="{Binding CanExport,
                    Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>
            </materialDesign:Card>


            <!-- DOANH THU + NHẬP -->
            <Grid Margin="0 0 0 20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>

                <materialDesign:Card Grid.Column="0" Padding="20">
                    <StackPanel>
                        <TextBlock Text="Doanh thu"
                                   Foreground="#1D4ED8"
                                   FontWeight="Bold"/>
                        <TextBlock Text="{Binding TodayRevenue, StringFormat={}{0:N0} đ}"
                                   FontSize="26"
                                   FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Grid.Column="2" Padding="20">
                    <StackPanel>
                        <TextBlock Text="Tổng nhập"
                                   Foreground="#1D4ED8"
                                   FontWeight="Bold"/>
                        <TextBlock Text="{Binding TotalImport, StringFormat={}{0:N0} đ}"
                                   FontSize="26"
                                   FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>

            <!-- TOP THUỐC -->
            <materialDesign:Card Padding="16" Margin="0 0 0 20">
                <StackPanel>
                    <TextBlock Text="Top thuốc bán chạy"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="#1D4ED8"
                               Margin="0 0 0 12"/>
                    <DataGrid ItemsSource="{Binding TopMedicines}"
                              AutoGenerateColumns="False"
                              Height="220">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding MedicineId}" Width="*"/>
                            <DataGridTextColumn Header="Tên thuốc" Binding="{Binding Name}" Width="2*"/>
                            <DataGridTextColumn Header="Đã bán" Binding="{Binding TotalSold}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </materialDesign:Card>

            <!-- KHÁCH HÀNG -->
            <materialDesign:Card Padding="16">
                <StackPanel>
                    <TextBlock Text="Khách hàng thân thiết"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="#1D4ED8"
                               Margin="0 0 0 12"/>
                    <DataGrid ItemsSource="{Binding LoyalCustomers}"
                              AutoGenerateColumns="False"
                              Height="220">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Tên" Binding="{Binding Name}" Width="2*"/>
                            <DataGridTextColumn Header="SĐT" Binding="{Binding Phone}" Width="*"/>
                            <DataGridTextColumn Header="Tổng chi" Binding="{Binding TotalExpenditure}" Width="*"/>
                            <DataGridTextColumn Header="Điểm" Binding="{Binding CumulativePoints}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </materialDesign:Card>
            <!-- Cảnh báo hàng tồn-->
            <!-- CẢNH BÁO HÀNG TỒN -->
            <materialDesign:Card Padding="16" Margin="0 20 0 0" Background="#EFF6FF">
                <StackPanel>
                    <TextBlock Text="Cảnh báo hàng tồn kho"
                   FontSize="18"
                   FontWeight="Bold"
                   Foreground="#1D4ED8"
                   Margin="0 0 0 12"/>

                    <DataGrid ItemsSource="{Binding StockWarnings}"
                  AutoGenerateColumns="False"
                  Height="240"
                  CanUserAddRows="False">
                        <DataGrid.Columns>

                            <DataGridTextColumn Header="Mã thuốc"
                                    Binding="{Binding MedicineId}"
                                    Width="*"/>

                            <DataGridTextColumn Header="Tên thuốc"
                                    Binding="{Binding MedicineName}"
                                    Width="2*"/>

                            <DataGridTextColumn Header="Số lượng"
                                    Binding="{Binding Quantity}"
                                    Width="*"/>

                            <DataGridTextColumn Header="Hạn sử dụng"
                                    Binding="{Binding ExpirationDate, StringFormat=dd/MM/yyyy}"
                                    Width="*"/>

                            <DataGridTextColumn Header="Cảnh báo"
                                    Binding="{Binding WarningType}"
                                    Width="2*"/>

                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </materialDesign:Card>

        </StackPanel>
    </ScrollViewer>
</UserControl>
